<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>2048 Base IA</title>

<style>
:root{
  --bg:#faf8ef;
  --board:#bbada0;
  --empty:#cdc1b4;
  --text:#776e65;
}
*{box-sizing:border-box;font-family:system-ui,sans-serif;}
body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:var(--bg);
}
.container{width:340px;}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
h1{margin:0;font-size:42px;color:var(--text);}
.score{
  background:#bbada0;
  color:#fff;
  padding:8px 14px;
  border-radius:6px;
  text-align:center;
}
.score span{font-size:12px;opacity:.8;display:block;}
.score b{font-size:20px;}

button{
  width:100%;
  padding:10px;
  margin:10px 0;
  border:none;
  border-radius:6px;
  background:#8f7a66;
  color:#fff;
  font-size:16px;
}

.board{
  position:relative;
  background:var(--board);
  padding:10px;
  border-radius:10px;
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
}

.cell{
  height:70px;
  border-radius:6px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  background:var(--empty);
  color:var(--text);
}

.overlay{
  position:absolute;
  inset:0;
  background:rgba(238,228,218,.85);
  display:none;
  align-items:center;
  justify-content:center;
  font-size:36px;
  font-weight:bold;
  color:#776e65;
  border-radius:10px;
}
</style>
</head>

<body>
<div class="container">
  <header>
    <h1>2048</h1>
    <div class="score">
      <span>Score</span>
      <b id="score">0</b>
    </div>
  </header>

  <button onclick="start()">Reiniciar</button>

  <div class="board" id="board">
    <div class="overlay" id="gameOver">Game Over</div>
  </div>
</div>

<script>
const size = 4;
let board, score, gameOver=false;

const boardEl = document.getElementById("board");
const scoreEl = document.getElementById("score");
const gameOverEl = document.getElementById("gameOver");

/* ---------- INICIALIZAÇÃO ---------- */
function start(){
  board = Array(size).fill().map(()=>Array(size).fill(0));
  score = 0;
  gameOver = false;
  gameOverEl.style.display="none";
  addTile(); addTile();
  render();
}

/* ---------- LÓGICA BASE ---------- */
function cloneBoard(b){ return b.map(r=>[...r]); }

function addTile(){
  const empty=[];
  board.forEach((r,i)=>r.forEach((v,j)=>{ if(!v) empty.push([i,j]); }));
  if(!empty.length) return;
  const [x,y] = empty[Math.random()*empty.length|0];
  board[x][y] = Math.random()<0.9 ? 2 : 4;
}

function slide(row){
  row=row.filter(v=>v);
  for(let i=0;i<row.length-1;i++){
    if(row[i]===row[i+1]){
      row[i]*=2;
      score+=row[i];
      row.splice(i+1,1);
    }
  }
  while(row.length<size) row.push(0);
  return row;
}

function move(dir){
  if(gameOver) return;
  const old = JSON.stringify(board);

  for(let i=0;i<size;i++){
    let col;
    if(dir==="left") board[i]=slide(board[i]);
    if(dir==="right") board[i]=slide([...board[i]].reverse()).reverse();
    if(dir==="up"){
      col=slide(board.map(r=>r[i]));
      col.forEach((v,j)=>board[j][i]=v);
    }
    if(dir==="down"){
      col=slide(board.map(r=>r[i]).reverse()).reverse();
      col.forEach((v,j)=>board[j][i]=v);
    }
  }

  if(old!==JSON.stringify(board)){
    addTile();
    render();
    if(isGameOver()) endGame();
  }
}

function isGameOver(){
  for(let i=0;i<size;i++){
    for(let j=0;j<size;j++){
      if(board[i][j]===0) return false;
      if(j<size-1 && board[i][j]===board[i][j+1]) return false;
      if(i<size-1 && board[i][j]===board[i+1][j]) return false;
    }
  }
  return true;
}

function endGame(){
  gameOver=true;
  gameOverEl.style.display="flex";
}

/* ---------- FUNÇÃO CHAVE PARA IA ---------- */
/* Simula movimento sem alterar o jogo real */
function simulateMove(dir, state){
  let temp = cloneBoard(state);

  function slideSim(row){
    row=row.filter(v=>v);
    for(let i=0;i<row.length-1;i++){
      if(row[i]===row[i+1]){
        row[i]*=2;
        row.splice(i+1,1);
      }
    }
    while(row.length<size) row.push(0);
    return row;
  }

  for(let i=0;i<size;i++){
    let col;
    if(dir==="left") temp[i]=slideSim(temp[i]);
    if(dir==="right") temp[i]=slideSim([...temp[i]].reverse()).reverse();
    if(dir==="up"){
      col=slideSim(temp.map(r=>r[i]));
      col.forEach((v,j)=>temp[j][i]=v);
    }
    if(dir==="down"){
      col=slideSim(temp.map(r=>r[i]).reverse()).reverse();
      col.forEach((v,j)=>temp[j][i]=v);
    }
  }
  return temp;
}

/* ---------- RENDER ---------- */
function tileColor(v){
  const map={
    2:"#eee4da",4:"#ede0c8",8:"#f2b179",16:"#f59563",
    32:"#f67c5f",64:"#f65e3b",128:"#edcf72",
    256:"#edcc61",512:"#edc850",1024:"#edc53f",2048:"#edc22e"
  };
  return map[v]||"#3c3a32";
}

function render(){
  boardEl.querySelectorAll(".cell").forEach(e=>e.remove());

  board.flat().forEach(v=>{
    const d=document.createElement("div");
    d.className="cell";
    if(v){
      d.textContent=v;
      d.style.background=tileColor(v);
      d.style.color=v>4?"#f9f6f2":"#776e65";
    }
    boardEl.insertBefore(d,gameOverEl);
  });
  scoreEl.textContent=score;
}

/* ---------- INPUT ---------- */
document.addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft") move("left");
  if(e.key==="ArrowRight") move("right");
  if(e.key==="ArrowUp") move("up");
  if(e.key==="ArrowDown") move("down");
});

let sx=0, sy=0;
document.addEventListener("touchstart",e=>{
  sx=e.touches[0].clientX;
  sy=e.touches[0].clientY;
},{passive:true});

document.addEventListener("touchend",e=>{
  const dx=e.changedTouches[0].clientX-sx;
  const dy=e.changedTouches[0].clientY-sy;
  if(Math.abs(dx)>Math.abs(dy)){
    if(Math.abs(dx)>30) move(dx>0?"right":"left");
  }else{
    if(Math.abs(dy)>30) move(dy>0?"down":"up");
  }
},{passive:true});

start();
</script>
</body>
</html>
